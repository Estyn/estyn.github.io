<!DOCTYPE html>



<html class="no-js" lang="en">


<head>
  <meta charset="utf-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="author" content="">
  <meta name="keywords" content="awesome, definitely"> 
  
  <meta property="og:site_name" content="">
  <meta property="og:title" content="">
  <meta property="og:url" content="">
  <meta property="og:description" content=""> 
  <meta property="og:type" content="website" />  

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="canonical" href="" />

  <link href="/favicon.ico" rel="icon">
  <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/js/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>
    !window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))
  </script>
  
  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> 
</head>
<body>

  <header>
    <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item two-fifths lap-four-sixths palm-one-whole">
      <a href="http://estynedwards.com/" class="site-title">Estyn&#39;s Blog</a>
    </div>

    <div class="grid__item three-fifths lap-two-sixths palm-one-whole">
      <nav>
        <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/">Blog</a></li>
</ul>
      </nav>
    </div>
  </div>
</div>
  </header>



  <div class="grid-wrapper">
    <div class="grid grid-center">

      <div class="grid__item two-thirds lap-one-whole palm-one-whole">

        <article class="post">
          <header>

            <h1 class="title indent"> Azure Dev Machine Auto Shutdown Part 2</h1>
            <div class="meta clearfix">
              <time class="pull-left" datetime="2014-01-15T07:33:19+00:00" pubdate="" data-updated="true"><i class="icon-calendar"></i> Fri Sep 6, 2013</time>

              <div class="pull-left">
                <i class="icon-tags"></i>
                <ul class="tags unstyled">
                  
                  <i class="fa fa-tag"></i> 
                  <li><a href="/categories/Azure/">Azure</a></li>
                  
                  <li><a href="/categories/VM/">VM</a></li>
                  
                  <li><a href="/categories/PowerShell/">PowerShell</a></li>
                  
                  <li><a href="/categories/Twillio/">Twillio</a></li>
                  
                  <li><a href="/categories/Dev%20VM/">Dev VM</a></li>
                   
                </ul>
              </div>
            </div>
          </header>
          
  
asds

Estyn Edwards

estyn

estyn

estynedwards

          
          

<p>In <a href="/blog/2013/09/03/auto-shutdown-for-windows-azure-vm/">Part 1</a> we looked at how to set-up a simple script to shut down an azure virtual machine after a period of inactivity.  The problem I had with the previous solution was determining the amount of inactivity time to set the script to run at.  I often found the machine was shutting down when I didn&rsquo;t want it to.  In this post we will add SMS notification when the machine is about to shut down and we will add an option for cancelling the shut down.
 &lt;!&ndash; more &ndash;&gt;</p>

<h2 id="step-1-get-a-twillio-https-www-twilio-com-user-account-account-if-you-don-t-already-have-one:0716029e4afe5b7c2e2968be46ffbacd">Step 1: Get a <a href="https://www.twilio.com/user/account">Twillio</a> account if you don&rsquo;t already have one.</h2>

<p>Twillio has a free trial account that will allow you to send free SMS&rsquo;s to your own phone.  Once you have a Twillio account you will need to write down your Account SID and you Auth Token, both can be found on the main account page in Twillio.  You will also need to write down your Twillio phone number.</p>

<h2 id="step-2-get-the-twillio-and-restsharp-dll:0716029e4afe5b7c2e2968be46ffbacd">Step 2: Get the Twillio and RestSharp dll</h2>

<p>In order to use Twillio from powershell we will need to have a copy of  Twillio.API.dll which has a dependency on  RestSharp.dll so we will need that as well.  I&rsquo;ve found NuGet to be the easiest way to get both.
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">Install-Package</span> <span style="color: #f8f8f2">Twilio</span>
</pre></div>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">Install-Package</span> <span style="color: #f8f8f2">RestSharp`</span>
</pre></div>
</p>

<p>Once you have the dlls save them in the same folder as your script.</p>

<h2 id="step-3-modify-the-script-to-send-an-sms-prior-to-shutting-down:0716029e4afe5b7c2e2968be46ffbacd">Step 3: Modify the script to send an SMS prior to shutting down</h2>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">Add-Type</span> <span style="color: #f8f8f2">-path</span> <span style="color: #e6db74">&quot;c:\Twilio.Api.dll&quot;</span>
<span style="color: #f8f8f2">Add-Type</span> <span style="color: #f8f8f2">-path</span> <span style="color: #e6db74">&quot;c:\RestSharp.dll&quot;</span>
<span style="color: #f8f8f2">$twilio</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">new-object</span> <span style="color: #f8f8f2">Twilio.TwilioRestClient(</span><span style="color: #e6db74">&quot;YOURACCOUNTSID&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;YOURAUTHTOKEN&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">$msg</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">$twilio.SendSmsMessage(</span><span style="color: #e6db74">&quot;YOURTWILLIONUMBER&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;YOURCELLPHONENUMBER&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;VM about to shutdown&quot;</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<h2 id="step-4-add-a-delay-to-the-script:0716029e4afe5b7c2e2968be46ffbacd">Step 4: Add a delay to the script</h2>

<p>Having a notification that the VM is about to shut down isn&rsquo;t very useful if you can&rsquo;t do anything about it so we will add a delay so that you can cancel the shut down after having received the notification.</p>

<p>I&rsquo;m using a nice script by <a href="http://jdhitsolutions.com/blog/2012/04/friday-fun-powershell-countdown/">Jeffery Hicks</a> that displays a nice countdown message on the screen before executing the shut down.  You can read his blog post to see how the script works.  The complete script is listed below, it sends an SMS then waits 15 minutes before executing the shut down command. The countdown can be interrupted with the esc key to prevent the shut down.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&lt;#</span>
<span style="color: #75715e"> -----------------------------------------------------------------------------</span>
<span style="color: #75715e"> Script: Countdown2.ps1</span>
<span style="color: #75715e"> Version: 0.9</span>
<span style="color: #75715e"> Author: Jeffery Hicks</span>
<span style="color: #75715e">    http://jdhitsolutions.com/blog</span>
<span style="color: #75715e">    http://twitter.com/JeffHicks</span>
<span style="color: #75715e">    http://www.ScriptingGeek.com</span>
<span style="color: #75715e"> Date: 4/27/2012</span>
<span style="color: #75715e"> Keywords:</span>
<span style="color: #75715e"> Comments:</span>
<span style="color: #75715e"> This is a variation on the Start-Countdown script from Josh Atwell</span>
<span style="color: #75715e"> (http://www.vtesseract.com/post/21414227113/start-countdown-function-a-visual-for-start-sleep)</span>

<span style="color: #75715e"> &quot;Those who forget to script are doomed to repeat their work.&quot;</span>

<span style="color: #75715e">  ****************************************************************</span>
<span style="color: #75715e">  * DO NOT USE IN A PRODUCTION ENVIRONMENT UNTIL YOU HAVE TESTED *</span>
<span style="color: #75715e">  * THOROUGHLY IN A LAB ENVIRONMENT. USE AT YOUR OWN RISK.  IF   *</span>
<span style="color: #75715e">  * YOU DO NOT UNDERSTAND WHAT THIS SCRIPT DOES OR HOW IT WORKS, *</span>
<span style="color: #75715e">  * DO NOT USE IT OUTSIDE OF A SECURE, TEST SETTING.             *</span>
<span style="color: #75715e">  ****************************************************************</span>
<span style="color: #75715e"> -----------------------------------------------------------------------------</span>
<span style="color: #75715e"> #&gt;</span>
 
<span style="color: #f8f8f2">Import-Module</span> <span style="color: #e6db74">&quot;C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Azure\Azure.psd1&quot;</span>
<span style="color: #66d9ef">Function</span> <span style="color: #f8f8f2">Start-Countdown</span> <span style="color: #f8f8f2">{</span>
<span style="color: #75715e">&lt;#</span>
<span style="color: #75715e">	</span><span style="color: #e6db74">.Synopsis</span><span style="color: #75715e"></span>
<span style="color: #75715e">	 Initiates a countdown before running a command</span>
<span style="color: #75715e">    </span>
<span style="color: #75715e">    </span><span style="color: #e6db74">.Description</span><span style="color: #75715e">  </span>
<span style="color: #75715e">     This is a variation on the Start-Countdown script from Josh Atwell</span>
<span style="color: #75715e">     (http://www.vtesseract.com/post/21414227113/start-countdown-function-a-visual-for-start-sleep). </span>
<span style="color: #75715e">     It can be used instead of Start-Sleep and provides a visual countdown </span>
<span style="color: #75715e">     progress during &quot;sleep&quot; times. At the end of the countdown, your </span>
<span style="color: #75715e">     command will execute. Press the ESC key any time during the countdown</span>
<span style="color: #75715e">     to abort. </span>
<span style="color: #75715e">     </span>
<span style="color: #75715e">     USING START-COUNTDOWN IN THE POWERSHELL ISE</span>
<span style="color: #75715e">     Results will vary slightly in the PowerShell ISE. If you use this in</span>
<span style="color: #75715e">     the ISE, it is recommended to use -Clear. You also cannot use the ESC</span>
<span style="color: #75715e">     key to abort the script if using the console. You&#39;ll need to press</span>
<span style="color: #75715e">     Ctrl+C. If using the progress bar, there is a Stop button in the ISE.</span>
<span style="color: #75715e">     If you abort in the ISE, you won&#39;t get the warning message.</span>
<span style="color: #75715e">     </span>
<span style="color: #75715e">     </span><span style="color: #e6db74">.Parameter</span><span style="color: #75715e"> Seconds</span>
<span style="color: #75715e">     The number of seconds to countdown. The default is 10.</span>
<span style="color: #75715e">     </span>
<span style="color: #75715e">     </span><span style="color: #e6db74">.Parameter</span><span style="color: #75715e"> Scriptblock</span>
<span style="color: #75715e">     A PowerShell scriptblock to execute at the end of the countdown.</span>
<span style="color: #75715e">     </span>
<span style="color: #75715e">     </span><span style="color: #e6db74">.Parameter</span><span style="color: #75715e"> ProgressBar</span>
<span style="color: #75715e">     Use a progress bar instead of the console.</span>
<span style="color: #75715e">     </span>
<span style="color: #75715e">     </span><span style="color: #e6db74">.Parameter</span><span style="color: #75715e"> Clear</span>
<span style="color: #75715e">     Clear the screen. Other wise, the countdown will use the current location.</span>
<span style="color: #75715e">     </span>
<span style="color: #75715e">     </span><span style="color: #e6db74">.Parameter</span><span style="color: #75715e"> Message</span>
<span style="color: #75715e">     The message to be displayed at the end of the countdown before any</span>
<span style="color: #75715e">     scriptblock is executed.</span>
<span style="color: #75715e">     	 </span>
<span style="color: #75715e">	</span><span style="color: #e6db74">.Example</span><span style="color: #75715e"></span>
<span style="color: #75715e">	 PS C:\&gt; Start-Countdown -Seconds 10 -clear</span>
<span style="color: #75715e">	 </span>
<span style="color: #75715e">	 This method will clear the screen and display descending seconds</span>
<span style="color: #75715e">	</span>
<span style="color: #75715e">	</span><span style="color: #e6db74">.Example</span><span style="color: #75715e"></span>
<span style="color: #75715e">	 PS C:\&gt; Start-Countdown -Seconds 30 -ProgressBar -scriptblock {get-service -comp (get-content computers.txt)}</span>
<span style="color: #75715e">	 </span>
<span style="color: #75715e">	 This method will display a progress bar on screen. At the end of the countdown the scriptblock will execute.</span>
<span style="color: #75715e">	 	 </span>
<span style="color: #75715e">	</span><span style="color: #e6db74">.Link</span><span style="color: #75715e"></span>
<span style="color: #75715e">	 http://jdhitsolutions.com/blog</span>
<span style="color: #75715e">     </span>
<span style="color: #75715e">     </span><span style="color: #e6db74">.Link</span><span style="color: #75715e"></span>
<span style="color: #75715e">     Write-Progress</span>
<span style="color: #75715e">	</span>
<span style="color: #75715e">#&gt;</span>
<span style="color: #66d9ef">Param</span><span style="color: #f8f8f2">(</span>
<span style="color: #f8f8f2">[</span><span style="color: #66d9ef">Parameter</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">Position</span><span style="color: #f8f8f2">=0,</span><span style="color: #66d9ef">HelpMessage</span><span style="color: #f8f8f2">=</span><span style="color: #e6db74">&quot;Enter seconds to countdown from&quot;</span><span style="color: #f8f8f2">)]</span>
<span style="color: #66d9ef">[Int]</span><span style="color: #f8f8f2">$Seconds</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">10,</span>
<span style="color: #f8f8f2">[</span><span style="color: #66d9ef">Parameter</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">Position</span><span style="color: #f8f8f2">=1,</span><span style="color: #66d9ef">Mandatory</span><span style="color: #f8f8f2">=$False,</span>
<span style="color: #66d9ef">HelpMessage</span><span style="color: #f8f8f2">=</span><span style="color: #e6db74">&quot;Enter a scriptblock to execute at the end of the countdown&quot;</span><span style="color: #f8f8f2">)]</span>
<span style="color: #66d9ef">[scriptblock]</span><span style="color: #f8f8f2">$Scriptblock,</span>
<span style="color: #66d9ef">[Switch]</span><span style="color: #f8f8f2">$ProgressBar,</span>
<span style="color: #66d9ef">[Switch]</span><span style="color: #f8f8f2">$Clear,</span>
<span style="color: #66d9ef">[String]</span><span style="color: #f8f8f2">$Message</span> <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&quot;Sutting down VM&quot;</span>
<span style="color: #f8f8f2">)</span>

<span style="color: #75715e">#save beginning value for total seconds</span>
<span style="color: #f8f8f2">$TotalSeconds=$Seconds</span>

<span style="color: #75715e">#get current cursor position</span>
<span style="color: #f8f8f2">$Coordinate</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">New-Object</span> <span style="color: #f8f8f2">System.Management.Automation.Host.Coordinates</span>
<span style="color: #f8f8f2">$Coordinate.X=$host.ui.rawui.CursorPosition.X</span>
<span style="color: #f8f8f2">$Coordinate.Y=$host.ui.rawui.CursorPosition.Y</span>

<span style="color: #66d9ef">If</span> <span style="color: #f8f8f2">($clear)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">Clear-Host</span>
    <span style="color: #75715e">#find the middle of the current window</span>
    <span style="color: #f8f8f2">$Coordinate.X=</span><span style="color: #66d9ef">[int]</span><span style="color: #f8f8f2">($host.ui.rawui.WindowSize.Width/2)</span>
    <span style="color: #f8f8f2">$Coordinate.Y=</span><span style="color: #66d9ef">[int]</span><span style="color: #f8f8f2">($host.ui.rawui.WindowSize.Height/2)</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #75715e">#define the Escape key</span>
<span style="color: #f8f8f2">$ESCKey</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">27</span>

<span style="color: #75715e">#define a variable indicating if the user aborted the countdown</span>
<span style="color: #f8f8f2">$Abort=$False</span>

<span style="color: #66d9ef">while</span> <span style="color: #f8f8f2">($seconds</span> <span style="color: #f92672">-ge</span> <span style="color: #f8f8f2">1)</span> <span style="color: #f8f8f2">{</span>

    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">($host.ui.RawUi.KeyAvailable)</span>
    		<span style="color: #f8f8f2">{</span>
    		<span style="color: #f8f8f2">$key</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">$host.ui.RawUI.ReadKey(</span><span style="color: #e6db74">&quot;NoEcho,IncludeKeyUp,IncludeKeyDown&quot;</span><span style="color: #f8f8f2">)</span>

    		<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">($key.VirtualKeyCode</span> <span style="color: #f92672">-eq</span> <span style="color: #f8f8f2">$ESCkey)</span>
    			<span style="color: #f8f8f2">{</span>
                <span style="color: #75715e">#ESC was pressed so quit the countdown and set abort flag to True</span>
    			<span style="color: #f8f8f2">$Seconds</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">0</span>
                <span style="color: #f8f8f2">$Abort=$True</span> 
    			<span style="color: #f8f8f2">}</span>
    		<span style="color: #f8f8f2">}</span>

    <span style="color: #66d9ef">If</span><span style="color: #f8f8f2">($ProgressBar){</span>
        <span style="color: #75715e">#calculate percent time remaining, but in reverse so the progress bar</span>
        <span style="color: #75715e">#moves from left to right</span>
        <span style="color: #f8f8f2">$percent=100</span> <span style="color: #f8f8f2">-</span> <span style="color: #f8f8f2">($seconds/$TotalSeconds)*100</span>
    	<span style="color: #f8f8f2">Write-Progress</span> <span style="color: #f8f8f2">-Activity</span> <span style="color: #e6db74">&quot;Countdown&quot;</span> <span style="color: #f8f8f2">-SecondsRemaining</span> <span style="color: #f8f8f2">$Seconds</span> <span style="color: #f8f8f2">-Status</span> <span style="color: #e6db74">&quot;Shutting doown in (esc to cancel)&quot;</span> <span style="color: #f8f8f2">-PercentComplete</span> <span style="color: #f8f8f2">$percent</span>
    	<span style="color: #f8f8f2">Start-Sleep</span> <span style="color: #f8f8f2">-Seconds</span> <span style="color: #f8f8f2">1</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">Else</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">($Clear)</span> <span style="color: #f8f8f2">{</span>
          <span style="color: #f8f8f2">Clear-Host</span>
        <span style="color: #f8f8f2">}</span> 
        <span style="color: #f8f8f2">$host.ui.rawui.CursorPosition=$Coordinate</span>
        <span style="color: #75715e">#write the seconds with padded trailing spaces to overwrite any extra digits such</span>
        <span style="color: #75715e">#as moving from 10 to 9</span>
        <span style="color: #f8f8f2">$pad=($TotalSeconds</span> <span style="color: #f92672">-as</span> <span style="color: #66d9ef">[string]</span><span style="color: #f8f8f2">).Length</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">($seconds</span> <span style="color: #f92672">-le</span> <span style="color: #f8f8f2">10)</span> <span style="color: #f8f8f2">{</span>
            <span style="color: #f8f8f2">$color=</span><span style="color: #e6db74">&quot;Red&quot;</span>
        <span style="color: #f8f8f2">}</span>
        <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
            <span style="color: #f8f8f2">$color=</span><span style="color: #e6db74">&quot;Green&quot;</span>
        <span style="color: #f8f8f2">}</span>
        <span style="color: #f8f8f2">Write-Host</span> <span style="color: #e6db74">&quot;ESC to cancel: </span><span style="color: #f8f8f2">$((</span><span style="color: #66d9ef">[string]</span><span style="color: #f8f8f2">$Seconds).Padright($pad))</span><span style="color: #e6db74">&quot;</span> <span style="color: #f8f8f2">-foregroundcolor</span> <span style="color: #f8f8f2">$color</span>
    	<span style="color: #f8f8f2">Start-Sleep</span> <span style="color: #f8f8f2">-Seconds</span> <span style="color: #f8f8f2">1</span>
    <span style="color: #f8f8f2">}</span>
    <span style="color: #75715e">#decrement $Seconds</span>
    <span style="color: #f8f8f2">$Seconds--</span>
<span style="color: #f8f8f2">}</span> <span style="color: #75715e">#while</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">($Progress)</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #75715e">#set progress to complete</span>
        <span style="color: #f8f8f2">Write-Progress</span> <span style="color: #f8f8f2">-Completed</span>
    <span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">-Not</span> <span style="color: #f8f8f2">$Abort)</span> <span style="color: #f8f8f2">{</span>
    
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">($clear)</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #75715e">#if $Clear was used, center the message in the console</span>
        <span style="color: #f8f8f2">$Coordinate.X=$Coordinate.X</span> <span style="color: #f8f8f2">-</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">[int]</span><span style="color: #f8f8f2">($message.Length)/2)</span>
    <span style="color: #f8f8f2">}</span>

    <span style="color: #f8f8f2">$host.ui.rawui.CursorPosition=$Coordinate</span>
    
    <span style="color: #f8f8f2">Write-Host</span> <span style="color: #f8f8f2">$Message</span> <span style="color: #f8f8f2">-ForegroundColor</span> <span style="color: #f8f8f2">Green</span>
    <span style="color: #75715e">#run the scriptblock if specified</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">($scriptblock)</span> <span style="color: #f8f8f2">{</span>    
        <span style="color: #f8f8f2">Invoke-Command</span> <span style="color: #f8f8f2">-ScriptBlock</span> <span style="color: #f8f8f2">$Scriptblock</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
<span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">Write-Warning</span> <span style="color: #e6db74">&quot;Countdown aborted&quot;</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #f8f8f2">}</span> <span style="color: #75715e">#end function</span>
<span style="color: #f8f8f2">$sb</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">{Stop-AzureVM</span> <span style="color: #f8f8f2">-Name</span> <span style="color: #e6db74">&quot;YOURVMNAME&quot;</span> <span style="color: #f8f8f2">-ServiceName</span> <span style="color: #e6db74">&quot;YOURSERVICENAME&quot;</span> <span style="color: #f8f8f2">-Force}</span>
 <span style="color: #f8f8f2">Add-Type</span> <span style="color: #f8f8f2">-path</span> <span style="color: #e6db74">&quot;c:\Twilio.Api.dll&quot;</span>
    <span style="color: #f8f8f2">Add-Type</span> <span style="color: #f8f8f2">-path</span> <span style="color: #e6db74">&quot;c:\RestSharp.dll&quot;</span>
    <span style="color: #f8f8f2">$twilio</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">new-object</span> <span style="color: #f8f8f2">Twilio.TwilioRestClient(</span><span style="color: #e6db74">&quot;YOURACCOUNTSID&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;YOURAUTHTOKEN&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">$msg</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">$twilio.SendSmsMessage(</span><span style="color: #e6db74">&quot;YOURTWILLIONUMBER&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;YOURCELLPHONENUMBER&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;VM about to shutdown&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">Start-Countdown</span> <span style="color: #f8f8f2">900</span> <span style="color: #f8f8f2">-Scriptblock</span> <span style="color: #f8f8f2">$sb</span> <span style="color: #f8f8f2">-ProgressBar</span>  <span style="color: #f8f8f2">-Clear</span>
</pre></div>
</p>

        </article>
      </div>
      <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
        <section class="social aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    Follow me!
  </h1>
  <ul class="unstyled">
  
    <li><a class="twitter" href="//twitter.com/estynedwards"><i class="icon-twitter"></i> Twitter</a></li>
    <li><a class="github" href="//github.com/estyn"><i class="icon-github"></i> Github</a></li>
    
  </ul>
</section>
<section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
	 <li class="post">
        <a href="http://estynedwards.com/blog/2015/01/15/using-geny-motion-for-xamarin-android-development-in-a-vm/">Using Geny Motion for Xamarin Android Development in a VM</a>
		
      </li>
	
	 <li class="post">
        <a href="http://estynedwards.com/blog/2013/12/12/better-logging-in-azure-mobile-services/">Better Logging in Azure Mobile Services</a>
		
      </li>
	
	 <li class="post">
        <a href="http://estynedwards.com/blog/2013/09/06/azure-dev-machine-auto-shutdown-part-2/">Azure Dev Machine Auto Shutdown Part 2</a>
		
      </li>
	
	 <li class="post">
        <a href="http://estynedwards.com/blog/2013/09/03/auto-shutdown-for-windows-azure-vm/">Auto Shutdown For Windows Azure VM</a>
		
      </li>
	
	 <li class="post">
        <a href="http://estynedwards.com/"></a>
		
      </li>
	
  
    
  </ul>
</section>
      </aside>

    </div>
  </div>
  <h1 class="indent title">Comments</h1>
<section id="comments">
  <div id="disqus_thread" class="post-comments"></div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    (function() {
    
    
   
var disqus_identifier = 'http://Estyn.github.io/blog/2013/12/12/better-logging-in-azure-mobile-services/';
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'estyn';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();

  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</section>
  <footer>
    <footer>
	<div class="grid-wrapper">
		<div class="grid">
			<div class="grid__item">
				<p class="copyright">
					All content by Estyn Edwards and licenced under <a href="//creativecommons.org/licenses/by-nc-sa/3.0/ie/">Creative Commons</a>.
					<br> Code under <a href="https://opensource.org/licenses/MIT">MIT Licence</a>.
				</p>
			</div>
		</div>
	</div>

</footer>
  </footer>

  

</body>

</html>